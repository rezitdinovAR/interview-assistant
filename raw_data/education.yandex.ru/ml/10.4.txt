---
title: Модели вида ARIMA
url: https://education.yandex.ru/handbook/ml/article/modeli-vida-arima
course: ml
chapter: 10. Практические главы
chapter_id: 10.4
---
Прежде чем перейти к рассмотрению модели ARIMA, познакомимся сначала с двумя другими моделями: скользящего среднего и моделью авторегрессии.
Модель скользящего среднего MA(
q
q)
Модель скользящего среднего порядка
q
q или просто MA(
q
q) предполагает следующую зависимость данных:
= μ+ε
t
+θ
1
ε
t−1
+...+θ
q
ε
t−q
,
где
y
t
y
t
— стационарный ряд со средним
μ
μ, а
ε
t
ε
t
— гауссовский белый шум, то есть
∼N(0,σ
2
) и независимы.
По сути наш ряд
y
t
y
t
выражается через сумму некоторого фиксированного среднего
μ
μ, значения белого шума в текущий момент времени
ε
t
ε
t
и не более
q
q предыдущих значений белого шума, домноженных на некоторые коэффициенты, которые являются параметрами модели.
Рассмотрим некоторые свойства модели MA(
q
q). Как уже было упомянуто выше, ряд
y
t
y
t
будет являтьcя стационарным со средним
μ
μ. Найдем также
D
y
t
Dy
t
. Воспользовавшись свойством независимости для
ε
t
ε
t
, можем заключить, что
=(1+θ
1
2
+⋯+θ
q
2
)σ
2
.
Посчитаем автоковариационную функцию для ряда
y
t
y
t
, то есть найдем значение
cov(y
t
,y
t+τ
). Легко понять, что если
τ
>
q
τ>q, то
cov(y
t
,y
t+τ
) = 0, т.к.
ε
t
ε
t
независимы. Если же
τ
≤
q
τ≤q, то тогда
cov(y
t
,y
t+τ
)=(θ
τ
+θ
1
θ
τ+1
+⋯+θ
q−τ
θ
q
)σ
2
.
Записав более компактно, можем получить:
cov(y
t
,y
t+τ
)={
σ
2
∑
j=0
q−τ
θ
j
θ
τ+j
,
0
τ≤q;
τ>q;
где
=1. Из посчитанных значений для дисперсии и ковариационной функции, можете попробовать получить выражение и для автокорреляционной функции. Ее особенностью будет как раз равенство нулю на лаге, превосходящим
q
q.
Посмотрим на визуализацию:
ma2
Модель авторегрессии AR(
p
p)
Модель авторегрессии для временного ряда можно записать следующим образом:
= α+φ
1
y
t−1
+...+φ
p
y
t−p
+ε
t
,
где
y
t
y
t
— стационарный ряд, а
ε
t
ε
t
— гауссовский белый шум, то есть
∼N(0,σ
2
) и независимы. Отметим, что, вообще говоря, для стационарности нужны некоторые условия на коэффициенты
,...,φ
p
.
По сути наш ряд
y
t
y
t
выражается через сумму некоторого фиксированного числа
α
α, значения белого шума в текущий момент времени
ε
t
ε
t
и не более
p
p предыдущих значений этого же ряда, домноженных на некоторые коэффициенты, которые являются параметрами модели.
Другими словами, модель AR(
p
p) — это модель
линейной
регрессией
линейной регрессией для которой
Таргет:
y
t
y
t
— значение ряда в момент времени
t
t
Признаки:
t−1
,...,y
t−p
— значения ряда в предыдущие моменты времени
Введем
L
L — оператор сдвига, обладающий следующими свойствами:
применение
L
L к ряду дает предыдущее значение этого же ряда:
t−1
.
применение
L
L к белому шуму дает предыдущее значение шума:
t−1
.
применение
L
L к константе — это константа:
L
c
=
c
.
Lc=c.
Оператор
L
L иногда называют также лаговым оператором. Можно рассматривать функции от оператора сдвига, например, кратное применение оператора
=L(Ly
t
)=L(y
t−1
)=y
t−2
или
t+1
. Для записей некоторых моделей временных рядов будет удобно использовать лаговый многочлен:
φ(L)=
i=1
Обратным к оператору
φ
(
L
)
φ(L) называют оператор
(L) такой, что:
φ(L)φ
−1
(L)y
t
=φ
−1
(L)φ(L)y
t
=y
t
Так, например, для
∣
φ
∣
<
1
∣φ∣<1 можно заключить, что:
1−φL
1
=(1−φL)
−1
=
i=1
Рассмотрим модель AR(
p
p):
= α+φ
1
y
t−1
+...+φ
p
y
t−p
+ε
t
С помощью оператора сдвига ее можно представить в следующем виде:
a(L)y
t
= α+ε
t
,
где
a(z)=1−φ
1
z−...−φ
p
z
p
— характеристический полином.
Сформулируем пару важных утверждений:
Любой стационарный (в широком смысле) процесс представим в виде
M
A
(
∞
)
MA(∞), то есть в виде модели скользящего среднего с неограниченным количеством слагаемых (конечное или бесконечное число). Этот результат так же известен как теорема Волда о декомпозиции временного ряда.
Модель
A
R
(
p
)
AR(p) задает стационарный временной ряд
⟺
⟺ все комплексные корни
a(z)=0 лежат вне единичного круга.
Приведем пояснение второго утверждения. В самом деле, пусть
,...,z
p
— все его комплексные корни (их ровно
p
p с учетом кратности), тогда справедливо представление:
a(z)=(z−z
1
)...(z−z
p
)=z
1
...z
p
(1−
z
1
z
)...(1−
z
p
z
)
Тогда при представлении временного ряда в виде
a(L)
α+ε
t
и дальнейшего его разложения на простые дроби возникнут слагаемые вида
Если при этом
z
j
z
j
лежит внутри единичного круга или на его границе, то соответствующий ряд будет расходящимся. На самом деле, случай
=1 мы в дальнейшем учтем.
В качестве примера рассмотрим подробнее модель
A
R
(
1
)
AR(1).
Зависимость имеет вид
=α+φy
t−1
+ε
t
, где
∼N(0,σ
2
). Для данного ряда можно выписать следующие свойства:
Уравнение
1−φz=0, имеет корень
λ
=
1
/
φ
λ=1/φ.
Тем самым,
A
R
(
1
)
AR(1) стационарен
∣φ∣<1. Кроме того, чем меньше
φ
φ, тем предыдущее значение ряда вносит меньший вклад в текущее значение.
Если ряд стационарен, то:
1−φ
1−φ
cov(y
t
,y
t−h
)=φ
h
⋅
1−φ
2
σ
2
.
Разберем первое равенство, остальные получаются аналогично. Возьмем математическое ожидание в уравнении ряда
=α+φEy
t−1
+Eε
t
Поскольку ряд стационарен, то его математическое ожидание не меняется во времени, а для белого шума математическое ожидание равно нулю. Тем самым мы получаем уравнение на
m
=
E
y
t
m=Ey
t
, откуда следует доказываемая формула.
Таким образом, в зависимости от значения
φ
φ мы можем получить следующие результаты:
Если
∣
φ
∣
<
1
∣φ∣<1, то
=μ+
j=0
∑
∞
φ
j
ε
t−j
— представление ряда в виде MA(
∞
∞).
Если
∣
φ
∣
=
1
∣φ∣=1, то
A
R
(
1
)
AR(1) — это случайное блуждание.
Если
∣
φ
∣
>
1
∣φ∣>1, то
A
R
(
1
)
AR(1) — экспоненциально растущий процесс.
Посмотрим на визуализацию.
ar1
В первом случае мы имеем модель
y
t
=
−
0.5
=−0.5y
t−1
+ε
t
, отрицательный коэффициент является следствием больших колебаний ряда.
Во втором случае модель
y
t
=
0.9
=0.9y
t−1
+ε
t
, большой положительный коэффициент делает ряд менее шумным.
В третьем случае показано несколько рядов вида случайного блуждания
t−1
+ε
t
, что соответствует случаю
φ
=
1
φ=1.
В четвертом случае показан экспоненциальный процесс
y
t
=
1.1
=1.1y
t−1
+ε
t
, на графике шум уже не заметен из-за масштаба.
На немного вернемся к модели MA(
q
q). Чуть выше мы выяснили, что при некоторых условиях на коэффиценты
φ
φ временной ряд модели AR(
p
p) будет стационарным, а значит имеет представление в виде MA(
∞
∞). На самом деле, модель скользящего среднего порядка
q
q тоже можно представить с помощью оператора
L
L следующим образом:
= μ+ε
t
+θ
1
ε
t−1
+...+θ
q
ε
t−q
= μ+b(L)ε
t
где
b(z)=1+θ
1
z+...+θ
q
z
q
— характеристический многочлен. Для простоты изложения пусть
μ
=
0
μ=0. Важным при такой записи оказывается понятие обратимости, то есть представления в виде
(L)y
t
,
которое означает, что ряд можно представить в виде бесконечной авторегрессионной модели.
Здесь, как и в рассуждениях выше, можно заключить, что временной ряд
y
t
y
t
обратим, если все комплексные корни
b(z)=0 лежат вне единичного круга.
Модель ARMA(
p
,
q
p,q)
Модель ARMA(
p
,
q
p,q) по сути является суммой моделей
A
R
(
p
)
AR(p) и
M
A
(
q
)
MA(q), иначе говоря, модель есть сумма нескольких предыдущих значений ряда и нескольких предыдущих значений белого шума с некоторым коэффициентами.
= α+φ
1
y
t−1
+...+φ
p
y
t−p
+ε
t
+θ
1
ε
t−1
+...+θ
q
ε
t−q
Эквивалентную запись ряда в терминах оператора сдвига можно получить, рассмотрев два многочлена
a(L)y
t
=α+b(L)ε
t
или
=μ+
a(L)
b(L)
ε
t
,
где
a(z)=1−φ
1
z−...−φ
p
z
p
, и
b(z)=1+θ
1
z+...+θ
q
z
q
.
Заметим, что во втором представлении константа
α
α заменена на
μ
=
E
y
t
μ=Ey
t
. На самом деле, стационарность такого ряда будет определяться только его AR(
p
p) компонентой, то есть значениями коэффициентов
φ
φ, так ряд в модели MA(
q
q) всегда является стационарным.
Модель ARIMA(
p
,
d
,
q
p,d,q)
Модель ARIMA(
p
,
d
,
q
p,d,q) — это расширение моделей типа ARMA на нестационарные временные ряды, которые однако могут стать стационарным после применениея процедуры дифференцирования ряда. Модель ARIMA(
p
,
d
,
q
p,d,q) для ряда
y
t
y
t
определяется как модель ARMA(
p
,
q
p,q) для ряда разностей порядка
d
d ряда
y
t
y
t
.
Разность порядка 1:
t−1
=(1−L)y
t
.
Разность порядка 2:
(1−L)
2
y
t
=(1−L)(y
t
−y
t−1
)=(y
t
−y
t−1
)−(y
t−1
−y
t−2
)=y
t
−2y
t−1
+y
t−2
.
Получаем формулу модели ARIMA:
a(L)(1−L)
d
y
t
=α+b(L)ε
t
или
(1−L)
d
y
t
=μ+
a(L)
b(L)
ε
t
.
То есть многочлен
(z)=a(z)(1−z)
d
имеет
d
d единичных корней.
Тем самым такая модель позволяет учесть нестационарности, в частности, тренд.
В качестве примера рассмотрим процесс случайного блуждания:
t−1
+ε
t
,
где
ε
t
ε
t
— белый шум. Как уже упомяналось ранее, такой ряд не является стационарным. Однако, если мы применим операцию дифференцирования, то можем перейти к новому, уже стационарном ряду
t−1
, который можно записать в виде:
Частичная автокорреляция
Для модели скользящего среднего порядка
q
q мы выяснили, что значения автокорреляционной функции для такого ряда оказывается равной нулю после лага
q
q. Эта особенность позволяет использовать автокорреляционную функцию для определения порядка модели скользящего среднего. Возникает разумный вопрос, как оценить порядок
p
p для модели AR(
p
p)? Здесь оказывается полезным понятие частичной (частной) автокорреляционной функции.
Частичная автокорреляция (PACF) — корреляция ряда с собой после снятия линеной зависимости от промежуточных значений ряда. Иначе говоря, мы хотим как-то учесть опосредованного влияние промежуточных значений ряда и оценить непосредственное влияние
y
t
−
τ
y
t−τ
на
y
t
y
t
. Чуть более формально частичную автокорреляцию можно записать следующим образом:
corr(y
t+1
,y
t
),
corr(y
t+τ
−y
t+τ
h−1
,y
t
−y
t
τ−1
),
τ=1;
τ⩾2,
где
τ−1
— линейная регрессия на
t−1
,y
t−2
,...,y
t−(τ−1)
τ−1
=φ
1
y
t−1
+φ
2
y
t−2
+...+φ
τ−1
y
t−(τ−1)
t+τ
τ−1
=φ
1
y
t+τ−1
+φ
2
y
t+τ−2
+...+φ
τ−1
y
t+1
Пример для
τ
=
2
τ=2:
=corr(y
t+2
−φ
1
y
t+1
,y
t
−φ
1
y
t−1
)
где
φ
1
φ
1
— МНК-оценка в модели
=φy
t−1
.
Можно показать, что значение частиной автокорреляции для модели авторегресии AR(
p
p) будет ненулевой для лагов
τ
≤
p
τ≤p и равняться нулю для лагов
τ
>
p
τ>p. Имеет место быть полная аналогия с автокорреляционной функцией и моделью MA(
q
q). Таким образом, исследование поведения автокорреляционной и частичной автокорреляционной функции может быть использовано для определения порядка
q
q модели скользящего среднего и порядка
p
p модели авторегрессии соответсвтенно.
Оценка коэффициентов в ARIMA
Пусть гиперпараметры
p
,
d
,
q
p,d,q фиксированы.&tab;В предположении, что
ε
t
ε
t
— гауссовский белый шум, в нашей модели мы можем выписать функцию правдоподобия
(θ,φ,α)=p
θ,φ,α
(y
1
,...,y
T
), где
θ,φ,α
(a
1
,...,a
T
) — соместная плотность. Из-за того, что
ε
t
ε
t
имеют нормальное распределение, она будет иметь разумный вид. Соответственно, в качестве оценок параметров берется оценка максимального правдоподобия.
Для поиска начальных приближение для параметров
p
p и
q
q воспользуемся автокорреляционной и частичной автокорреляционной функцией.
Начальное приближение
p
p: последний значимый пик у PACF.
Начальное приближение
q
q: последний значимый пик у ACF.
Далее обычно используется поиск по сетке вокруг подобранных значений, минимизируя информационный критерий:
AIC=−2ℓ
∗
+2(p+q+1) — критерий Акаике;
AIC
c
=−2ℓ
∗
+
T−p−q−2
2(p+q+1)(p+q+2)
— критерий Акаике (короткие ряды);
log
BIC=−2ℓ
∗
+(logT−2)(p+q+1) — Байесовский информационный критерий или критерий Шварца,
где
=lnL
) — логарифм функции правдоподобия,
T
T — длина временного ряда.
Приведем некоторый план при применению модели ARIMA для прогнозирования временных рядов.
Анализ выбросов: замена нерелевантых выбросов на NA или усреднение по соседним элементам.
Стабилизация дисперсии (преобразования).
Дифференцирование, если ряд не стационарен.
Выбор пилотных
p
p и
q
q по PACF и ACF.
Вокруг этих параметров подбираем оптим. модель по
A
I
C
AIC/
A
I
C
c
AIC
c
.
Пошаговое построение прогноза:
— для
t
⩽
T
t⩽T:
— для
t
>
T
t>T:
⟹0;
— для
t
>
T
t>T:
Построение предсказательного интервала:
— если остатки модели нормальны и гомоскедастичны (дисперсия постоянна), то строится теоретический предсказательный интервал
(h)=
σ
2
(1+
i=1
∑
h−1
ψ
i
2
)
где
h
h — горизонт прогнозирования,
σ
^
2
σ
2
— оценка на дисперсию шума
— коэф. для ряда при его представлении в виде бесконечного процесса скользящего среднего. И
σ
^
2
σ
2
, и
ψ
^
i
ψ
i
могут быть выражены через оценки на параметры
φ
φ и
θ
θ.
— иначе интервалы строятся с помощью бутстрепа.
Модели SARIMA и ARIMAX
Рассмотрим некоторые расширение модели ARIMA. Обобщение модели ARIMA на ряды с наличием сезонной составляющей назвается SARIMA. Пусть
s
s — известная сезонность ряда. Добавим в модель ARIMA(
p
,
d
,
q
p,d,q) компоненты, отвечающие за значения в предыдущие сезоны. Тогда модель SARIMA
(p,d,q)×(P,D,Q)
s
может быть записана следующим образом:
(1−L)
d
(1−L
s
)
D
y
t
=μ+
a(L)A(L
s
)
b(L)B(L
s
)
ε
t
,
где
a(z)=1−φ
1
z−...−φ
b(z)=1+θ
1
z+...+θ
A(z)=1−φ
1
s
z−⋯−φ
B(z)=1+θ
1
s
z+⋯+θ
Q
s
z
Q
.
Параметр сезонного дифференцирования
D
D, а также параметры
P
,
Q
P,Q подбираются из тех же соображений, что и для
p
,
d
,
q
p,d,q, но только с поправкой, что делается это с учетом сезонности
s
s. ARIMAX — обобщение модели ARIMA, которая учитывает некоторые экзогенные факторы. Пусть
— ряд регрессоров, известный до начала прогноза.
Простой вариант:
(1−L)
d
y
t
=μ+
i=1
∑
n
a(L)
a(L)
b(L)
ε
t
Общий случай:
(1−L)
d
y
t
=μ+
i=1
∑
n
v
i
(L)
u
i
(L)
x
t
i
+
a(L)
b(L)
ε
t
Пример:
x
t
=
I
{
в момент времени t праздник
}
x
t
=I{в момент времени t праздник}
Вышеуказанные модели можно объединить и получить SARIMAX
(p,d,q)
times(P,D,Q)
(1−L)
d
(1−L
s
)
D
y
t
=μ+
i=1
∑
n
v
i
(L)
u
i
(L)
x
t
i
+
a(L)A(L
s
)
b(L)B(L
s
)
ε
t
Проведем аналогию с линейной регрессией. Это линейная по признакам модель, в которой
Отклик:
y
t
y
t
— значение ряда в моменты времени
t
t
Признаки:
t−1
,...,y
t−p
— значения ряда в предыдущие моменты времени
Значение ряда за предыдущие сезоны
Значения признаков в предыдущие моменты времени
Значения признаков в предыдущие сезоны
Ошибка: сумма шума за предыдущие моменты времени и предыдущие сезоны.
Знак вопроса
Пройдите квиз по параграфу
Чтобы закрепить пройденный материал
Сообщить об ошибке
Предыдущий параграф
10.3. Аналитика временных рядов
Следующий параграф
10.5. Задача ранжирования
