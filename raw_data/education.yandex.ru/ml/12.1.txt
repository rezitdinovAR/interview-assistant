---
title: Bias-variance decomposition
url: https://education.yandex.ru/handbook/ml/article/bias-variance-decomposition
course: ml
chapter: 12. Теория ML
chapter_id: 12.1
---
Классический взгляд на то, почему слишком сложные модели переобучаются
В данном параграфе мы изучим инструмент, который позволяет анализировать ошибку алгоритма в зависимости от некоторого набора факторов, влияющих на итоговое качество его работы. Этот инструмент в литературе называется bias-variance decomposition — разложение ошибки на смещение и разброс. В разложении, на самом деле, есть и третья компонента — случайный шум в данных, но ему не посчастливилось оказаться в названии. Данное разложение оказывается полезным в некоторых теоретических исследованиях работы моделей машинного обучения, в частности, при анализе свойств ансамблевых моделей.
Некоторые картинки в тексте кликабельны. Это означает, что они были заимствованы из какого-то источника и при клике вы сможете перейти к этому источнику.
Вывод разложения bias-variance для MSE
Рассмотрим задачу регрессии с квадратичной функцией потерь. Представим также для простоты, что целевая переменная
y
y — одномерная и выражается через переменную
x
x как:
y=f(x)+ε,
где
f
f — некоторая детерминированная функция, а
ε
ε — случайный шум со следующими свойствами:
Eε=0,Varε=Eε
2
=σ
2
.
В зависимости от природы данных, которые описывает эта зависимость, её представление в виде точной
f
(
x
)
f(x) и случайной
ε
ε может быть продиктовано тем, что:
данные на самом деле имеют случайный характер;
измерительный прибор не может зафиксировать целевую переменную абсолютно точно;
имеющихся признаков недостаточно, чтобы исчерпывающим образом описать объект, пользователя или событие.
Функция потерь на одном объекте
x
x равна
MSE=(y(x)−a(x))
2
Однако знание значения MSE только на одном объекте не может дать нам общего понимания того, насколько хорошо работает наш алгоритм. Какие факторы мы бы хотели учесть при оценке качества алгоритма? Например, то, что выход алгоритма на объекте
x
x зависит не только от самого этого объекта, но и от выборки
X
X, на которой алгоритм обучался:
X=((x
1
,y
1
),…,(x
a(x)=a(x,X)
Кроме того, значение
y
y на объекте
x
x зависит не только от
x
x, но и от реализации шума в этой точке:
y(x)=y(x,ε)
Наконец, измерять качество мы бы хотели на тестовых объектах
x
x — тех, которые не встречались в обучающей выборке, а тестовых объектов у нас в большинстве случаев более одного. При включении всех вышеперечисленных источников случайности в рассмотрение логичной оценкой качества алгоритма
a
a кажется следующая величина:
Q(a)=E
x
E
X,ε
[y(x,ε)−a(x,X)]
2
Внутреннее матожидание позволяет оценить качество работы алгоритма в одной тестовой точке
x
x в зависимости от всевозможных реализаций
X
X и
ε
ε, а внешнее матожидание усредняет это качество по всем тестовым точкам.
Замечание. Запись
E
X
,
ε
E
X,ε
в общем случае обозначает взятие матожидания по совместному распределению
X
X и
ε
ε. Однако, поскольку
X
X и
ε
ε независимы, она равносильна последовательному взятию матожиданий по каждой из переменных:
X,ε
=E
X
E
ε
, но последний вариант выглядит несколько более громоздко.
Попробуем представить выражение для
Q
(
a
)
Q(a) в более удобном для анализа виде. Начнём с внутреннего матожидания:
X,ε
[y(x,ε)−a(x,X)]
2
=E
X,ε
[f(x)+ε−a(x,X)]
не зависит от
множители независимы
X,ε
[
не зависит от ε
(f(x)−a(x,X))
2
+
множители независимы
2ε⋅(f(x)−a(x,X))
[(f(x)−a(x,X))
2
]+2
=0
E
ε
[ε]
⋅E
X
(f(x)−a(x,X))+E
[(f(x)−a(x,X))
2
]+σ
2
Из общего выражения для
Q
(
a
)
Q(a) выделилась шумовая компонента
σ
2
σ
2
. Продолжим преобразования:
[(f(x)−a(x,X))
2
]=E
X
[(f(x)−E
X
[a(x,X)]+E
X
[a(x,X)]−a(x,X))
не зависит от
не зависит от X
[(f(x)−E
X
[a(x,X)])
2
]
+
=Var
X
[a(x,X)]
E
X
[(a(x,X)−E
X
[a(x,X)])
не зависит от
+2E
X
[
не зависит от X
(f(x)−E
X
[a(x,X)])
⋅(E
X
[a(x,X)]−a(x,X))]=
bias
bias
X
a(x,X)
f(x)−E
X
[a(x,X)]
)
2
+Var
X
[a(x,X)]+2(f(x)−E
X
[a(x,X)])⋅
=0
(E
X
[a(x,X)]−E
X
[a(x,X)])
=
=
bias
=bias
X
2
a(x,X)+Var
X
[a(x,X)]
Таким образом, итоговое выражение для
Q
(
a
)
Q(a) примет вид
bias
Q(a)=E
x
E
X,ε
[y(x,ε)−a(x,X)]
2
=E
x
bias
X
2
a(x,X)+E
x
Var
X
[a(x,X)]+σ
2
,
где
bias
bias
X
a(x,X)=f(x)−E
X
[a(x,X)]
— смещение предсказания алгоритма в точке
x
x, усреднённого по всем возможным обучающим выборкам, относительно истинной зависимости
Var
X
[a(x,X)]=E
X
[a(x,X)−E
X
[a(x,X)]]
2
— дисперсия (разброс) предсказаний алгоритма в зависимости от обучающей выборки
[y(x,ε)−f(x)]
2
— неустранимый шум в данных.
Смещение показывает, насколько хорошо с помощью данного алгоритма можно приблизить истинную зависимость
f
f, а разброс характеризует чувствительность алгоритма к изменениям в обучающей выборке. Например, деревья маленькой глубины будут в большинстве случаев иметь высокое смещение и низкий разброс предсказаний, так как они не могут слишком хорошо запомнить обучающую выборку. А глубокие деревья, наоборот, могут безошибочно выучить обучающую выборку и потому будут иметь высокий разброс в зависимости от выборки, однако их предсказания в среднем будут точнее. На рисунке ниже приведены возможные случаи сочетания смещения и разброса для разных моделей:
Источник
Синяя точка соответствует модели, обученной на некоторой обучающей выборке, а всего синих точек столько, сколько было обучающих выборок. Красный круг в центре области представляет ближайшую окрестность целевого значения. Большое смещение соответствует тому, что модели в среднем не попадают в цель, а при большом разбросе модели могут как делать точные предсказания, так и довольно сильно ошибаться.
Полученное нами разложение ошибки на три компоненты верно только для квадратичной функции потерь. Для других функций потерь существуют более общие формы этого разложения (Domigos, 2000, James, 2003) с похожими по смыслу компонентами. Это позволяет предполагать, что для большинства основных функций потерь имеется некоторое представление в виде смещения, разброса и шума (хоть и, возможно, не в столь простой аддитивной форме).
Пример расчёта оценок bias и variance
Попробуем вычислить разложение на смещение и разброс на каком-нибудь практическом примере. Наши обучающие и тестовые примеры будут состоять из зашумлённых значений целевой функции
f
(
x
)
f(x), где
f
(
x
)
f(x) определяется как
sin
⁡
x
f(x)=xsinx
В качестве шума добавляется нормальный шум с нулевым средним и дисперсией
σ
2
σ
2
, равной во всех дальнейших примерах 9. Такое большое значение шума задано для того, чтобы задача была достаточно сложной для классификатора, который будет на этих данных учиться и тестироваться. Пример семпла из таких данных:
20
Посмотрим на то, как предсказания деревьев зависят от обучающих подмножеств и максимальной глубины дерева. На рисунке ниже изображены предсказания деревьев разной глубины, обученных на трёх независимых подвыборках размера 20 (каждая колонка соответствует одному подмножеству):
20
Глядя на эти рисунки, можно выдвинуть гипотезу о том, что с увеличением глубины дерева смещение алгоритма падает, а разброс в зависимости от выборки растёт. Проверим, так ли это, вычислив компоненты разложения для деревьев со значениями глубины от 1 до 15.
Для обучения деревьев насемплируем 1000 случайных подмножеств
train
=(x
train
,y
train
) размера 500, а для тестирования зафиксируем случайное тестовое подмножество точек
test
также размера 500. Чтобы вычислить матожидание по
ε
ε, нам нужно несколько экземпляров шума
ε
ε для тестовых лейблов:
test
=y(x
test
,
ε
^
)=f(x
test
)+
ε
^
Положим количество семплов случайного шума равным 300. Для фиксированных
train
=(x
train
,y
train
) и
test
=(x
test
,y
test
) квадратичная ошибка вычисляется как
MSE=(y
test
−a(x
test
,X
train
))
2
Взяв среднее от
M
S
E
MSE по
train
test
и
ε
ε, мы получим оценку для
Q
(
a
)
Q(a), а оценки для компонент ошибки мы можем вычислить по ранее выведенным формулам.
На графике ниже изображены компоненты ошибки и она сама в зависимости от глубины дерева:
20
По графику видно, что гипотеза о падении смещения и росте разброса при увеличении глубины подтверждается для рассматриваемого отрезка возможных значений глубины дерева. Правда, если нарисовать график до глубины 25, можно увидеть, что разброс становится равен дисперсии случайного шума. То есть деревья слишком большой глубины начинают идеально подстраиваться под зашумлённую обучающую выборку и теряют способность к обобщению:
20
Код для подсчёта разложения на смещение и разброс, а также код отрисовки картинок можно найти в данном ноутбуке.
Bias-variance trade-off: в каких ситуациях он применим
В книжках и различных интернет-ресурсах часто можно увидеть следующую картинку:
Источник
Она иллюстрирует утверждение, которое в литературе называется bias-variance trade-off: чем выше сложность обучаемой модели, тем меньше её смещение и тем больше разброс, и поэтому общая ошибка на тестовой выборке имеет вид
U
U-образной кривой. С падением смещения модель всё лучше запоминает обучающую выборку, поэтому слишком сложная модель будет иметь нулевую ошибку на тренировочных данных и большую ошибку на тесте. Этот график призван показать, что существует оптимальная сложность модели, при которой соблюдается баланс между переобучением и недообучением и ошибка при этом минимальна.
Существует достаточное количество подтверждений bias-variance trade-off для непараметрических моделей. Например, его можно наблюдать для метода
k
k ближайших соседей при росте
k
k и для ядерной регрессии при увеличении ширины окна
σ
σ (Geman et al., 1992):
20
Чем больше соседей учитывает
k
k-NN, тем менее изменчивым становится его предсказание, и аналогично для ядерной регрессии, из-за чего сложность этих моделей в некотором смысле убывает с ростом
k
k и
σ
σ. Поэтому традиционный график bias-variance trade-off здесь симметрично отражён по оси
x
x.
Однако, как показывают последние исследования, непременное возрастание разброса при убывании смещения не является абсолютно истинным предположением. Например, для нейронных сетей с ростом их сложности может происходить снижение и разброса, и смещения. Одна из наиболее известных статей на эту тему — статья Белкина и др. (Belkin et al., 2019), в которой, в частности, была предложена следующая иллюстрация:
20
Слева — классический bias-variance trade-off: убывающая часть кривой соответствует недообученной модели, а возрастающая — переобученной. А на правой картинке — график, называемый в статье double descent risk curve. На нём изображена эмпирически наблюдаемая авторами зависимость тестовой ошибки нейросетей от мощности множества входящих в них параметров (
H
H). Этот график разделён на две части пунктирной линией, которую авторы называют interpolation threshold. Эта линия соответствует точке, в которой в нейросети стало достаточно параметров, чтобы без особых усилий почти идеально запомнить всю обучающую выборку. Часть до достижения interpolation threshold соответствует «классическому» режиму обучения моделей: когда у модели недостаточно параметров, чтобы сохранить обобщающую способность при почти полном запоминании обучающей выборки. А часть после достижения interpolation threshold соответствует «современным» возможностям обучения моделей с огромным числом параметров. На этой части графика ошибка монотонно убывает с ростом количества параметров у нейросети. Авторы также наблюдают похожее поведение и для «древесных» моделей: Random Forest и бустинга над решающими деревьями. Для них эффект проявляется при одновременном росте глубины и числа входящих в ансамбль деревьев.
В качестве вывода к этому разделу хочется сформулировать два основных тезиса:
Bias-variance trade-off нельзя считать непреложной истиной, выполняющейся для всех моделей и обучающих данных.
Разложение на смещение и разброс не влечёт немедленного выполнения bias-variance trade-off и остаётся верным и для случая, когда все компоненты ошибки (кроме неустранимого шума) убывают одновременно. Этот факт может оказаться незамеченным из-за того, что в учебных пособиях часто разговор о разложении дополняется иллюстрацией с
U
U-образной кривой, благодаря чему в сознании эти два факта могут слиться в один.
Список литературы
Блог-пост про bias-variance от
Йоргоса Папахристудиса
Блог-пост про bias-variance от Скотта Фортмана-Роу
Статьи от Домингоса (2000) и Джеймса (2003) про обобщённые формы bias-variance decomposition
Блог-пост от Брейди Нила про необходимость пересмотра традиционного взгляда на bias-variance trade-off
Статья Гемана и др. (1992), в которой была впервые предложена концепция bias-variance trade-off
Статья Белкина и др. (2019), в которой был предложен double-descent curve
Знак вопроса
Пройдите квиз по параграфу
Чтобы закрепить пройденный материал
Сообщить об ошибке
Предыдущий параграф
11.2. Краудсорсинг
Следующий параграф
13.1. Введение в теорию глубокого обучения
